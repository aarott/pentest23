# h3 Lab kid

Kone millä tein harjoituksen:

AMD Ryzen 2600X Six-Core Processor 3.6 ghz  

16gb RAM  

Windows 10 Pro 64-bit käyttöjärjestelmä  

Oracle VM VirtualBox Manager

##

Läksy löytyy sivulta:  

https://terokarvinen.com/2023/eettinen-hakkerointi-2023/  

## x) Lue ja tiivistä  


https://learning.oreilly.com/library/view/mastering-kali-linux/9781801819770/Text/Chapter_10.xhtml#_idParaDest-248  

- Metasploit Framework on open-source työkalu tunkeutumistestausta varten Ruby kielellä   
- Framework on jakautunut libraries, interfaces ja modules  
- Libraries /usr/share/Metasploit-framework/lib/   
- sudo msfconsole pääsee console interfaceen  
- modules (exploits, payloads, auxiliary modules, post modules, encoders, no operations)  
- choose and configure exploit, check target system, choose and configure the payload,choose encoding technique to bypass detection controls, execute exploit  
- database setup ja konfiguraatio, nmap scannaus, hyökkääminen exploitilla  
- meterpreter interaktiivinen shelli millä voi hyökätä ja ajaa koodia targetilla  
- exploit db julkinen tietokanta missä exploitteja eri softaversioille / searchsploitilla voi etsiä kalissa näitä / miten exploitit ajetaan


HTB PRECIOUS: https://0xdf.gitlab.io/2023/05/20/htb-precious.html  

- tavalline nettisivu minkä pitäisi generoida urli tiedostosta pdf-tiedosto  
- käytetään metadataa pdf-tiedostosta löydettääksi mitä teknologiaa käytetään, commadn injection exploitti millä päästään boxiin, etsitään credentialsit ruby bundler  
tiedostosta millä päästään käyttäjän tietoihin   
- roottiin päästäkseen käytetään yaml deserialization vulnerability scriptiä   
- rootissa tarkastellaan weppiapplikaatiota, mite se o hostattu, ja fixataan bugi mikä antaa luvan generoida pdf sivuston itse  
- nmap portit (ssh ja http auki), open ssh debian 11 bullseye  
- ffuz subdomain brute force, ei löydä mitään muuta, sivu on siis precious.htb  
- exiftool löytää Creator by pdfkit v.0.8.6   
- löytää googlesta hakemalla Snyk articlen missä exploitti pdfkittiin  
- pääsee shelliin ja vaihtaa shellin script and stty   
- käyttäjän löytö jap ääsy: ruby config filestä löytää henry käyttäjän ja salasanan --> pääsy sisään käyttäjälle  
- sudo -l , löytyy update_depencies.rb tiedoston -> depencies.yml tiedosto --> löytyy rootin id -> tallentaa update_dependencies.rb tiedostoon --> pääsee shelliin missä root  
- löytää DNS ongelman, josta selviää miten saa korjattua, että sivustosta saa pdf version

Nyrkkeilysäkki:

Googlasin "tero karvinen nyrkkeilysäkki" ja löysin tämän mielestäni selkeän raportin:  
  
https://myllys.wordpress.com/tunkeutumistestaus-2021-syksy-harjoitus-2/  

- lataa metasploit 2 https://sourceforge.net/projects/metasploitable/ ; ja asenna se virtualboxiin  
- host-only verkon luonti, Kali linuxin VB settingseistä uusi hosti adapteri, kalin saa pois netistä raksimalla cable connected pois päältä  
- metasploit VB network settings, Adapter 1 Host-only adapter,  Kali Linux adapter 2 host only adapter päälle  
- Kalista pingataan nettiin ja tarkistetaan, että ei ole päällä. Kalista pingataan Metasploit koneeseen ja tarkistetaan, että yhteys toimii

##

## a) Asenna Kali virtuaalikoneeseen  

Olin jo aikasemmin asentanut Kali Linuxin.

Raporttini tehtävästä löytyy: https://github.com/aarott/pentest23/blob/main/h-1.md#d-asenna-linux-virtuaalikoneeseen  

##

## b) Asenna Metasploitable 2 virtuaalikoneeseen  

Ohjeet Metasploitin asennukseen löysin https://myllys.wordpress.com/tunkeutumistestaus-2021-syksy-harjoitus-2/ raportista.  

Menin https://sourceforge.net/projects/metasploitable/ ja painoin Download.

Zippi tiedoston purettua huomasin, että kansiossa on suoraan Virtual Box Hard Disk file.  

Menin Virtual Boxiin --> New  

Name and operating system laitoin Metasploitable 2 ja Linux 64-bit. 

Valitsin hard disk ja use an existing hard disk -> tänne sitten sen Metasploitin hard disk tiedosto ja Finish.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/23af0e61-4e14-449d-ba0b-dd8f3313866d)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/93cd98a9-612f-4f59-99e7-1b72f561eca9)    

##  

![image](https://github.com/aarott/pentest23/assets/78908566/f05d7d33-f7ff-4186-b49c-20be7c49133b)    

##  

Nyt Metasploitable 2 näkyy VirtualBox Managerissa, käynnistin sen ja näyttäisi toimivan.  

##

## c) Koneille virtuaaliverkko  

Tehtävän ohjeissa pitää tehdä virtuaaliverkko, jossa  

- Kali saa yhteyden Internettiin, mutta sen voi laittaa pois päältä  
- Kalin ja Metasploitablen välillä on host-only network, niin että porttiskannatessa ym. koneet on eristetty intenetistä, mutta ne saavat yhteyden toisiinsa  
- Osoita eri komennoilla, että Internet-yhteys katkeaa: 'ping 1.1.1.1', 'ping www.google.com', 'curl www.google.com'  

Käytin taas https://myllys.wordpress.com/tunkeutumistestaus-2021-syksy-harjoitus-2/ raporttia avukseni tässä tehtävässä.  

VirtualBoxissa menin Network settingseihin ja menin luomaan uuuden Host-Only Networkin. Asetuksista laitoin päälle DHCP:n, jotta laitteet määrittää automaattisesti IP-osoitteet.  

##

![image](https://github.com/aarott/pentest23/assets/78908566/013b2d01-98d1-45da-b289-a266ea52674b)  

##

Menin VirtualBoxin Metasploitable 2 settings -> Network -> Adapter 1 -> valitsin tähän nyt äsken määritetyn uuden Host-Only adapterin.  

##

![image](https://github.com/aarott/pentest23/assets/78908566/3c895862-557c-4510-bdfa-9e03ac356daa)

##

Menin VirtualBoxin Kali settings -> Network -> Adapter 2 -> valitsin tähän nyt äsken määritetyn uuden Host-Only adapterin. 

* Huom sitten kun Kali halutaan ottaa pois netistä niin Adapter 1 kohdassa ruksataan pois kohta Cable Connected.

![image](https://github.com/aarott/pentest23/assets/78908566/f758c759-fcea-4082-b840-7c35c37a1ee5)  

![image](https://github.com/aarott/pentest23/assets/78908566/f0f27d82-7117-463c-81b1-a2be96e81ad4)  

##  


Käynnistin Kali Linuxin ja Metasploitable 2 koneet päälle.  

Pikaisesti piti googlettaa miten Metasploitable 2 koneeseen pääsee sisään. Metasploitable2 koneen käyttäjä ja salasana on sama `msfadmin`. 

Pingasin Teron kotisivua ja tarkistin, että kone ei saa yhteyttä nettiin. Ajoin sen jälkeen komennon `ifconfig` mistä sain ip-osoitteen mitä voidaan pingata Kalilla ja testata, että yhteys toimii.  

![image](https://github.com/aarott/pentest23/assets/78908566/603567ae-75d3-4cd7-a9e6-de25b68fbf26)  


Metasploitable 2 koneen ip-osoite on: 192.168.78.4

Menin sitten Kaliin pingasin taas Teron kotisivua tarkistaakseni, että netti ei toimi. Kokeilin myös curl google.com.  Sen jälkeen pingasin Metasploitable 2 konetta joka vastasi onnistuneesti.  

![image](https://github.com/aarott/pentest23/assets/78908566/50c2d936-a957-4651-bca8-80e9bee700d5)


##  d)  Etsi Metasploit porttiskannaamalla  

Menin ensiksi Kalilla metasploitin consoleen komennolla `msfconsole` 
Yritin ajaa komennon `db_nmap -sn ip` mutta sain vastaukseksi, että "database not connected".  

##

![image](https://github.com/aarott/pentest23/assets/78908566/508bd904-4940-4920-9925-7ed2227ae010)  

##

Googletin ja otin ekasta linkistä ohjeet https://miteshshah.github.io/linux/kali/how-to-fix-metasploit-database-not-connected-or-cache-not-built/  

Ajoin komennot: 

`$ sudo service postgresql start`  
`$ sudo msfdb init`  
`$ db_status`  

![image](https://github.com/aarott/pentest23/assets/78908566/bd423b4c-337e-460f-9076-c34cb14cbe66)

##  

Nyt kokeilin db_nmap uudestaan ja toimii.  Tarkistin selaimella ip-osoitetta, että löysin oikean osoitteen Metasploitable weppi-palvelimelle.  

![image](https://github.com/aarott/pentest23/assets/78908566/94886e85-7189-45f6-a919-7d81e4aeff72)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/612f440f-eeda-47aa-889c-2c01ad0089df)  

##  

















 




