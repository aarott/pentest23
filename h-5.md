# h5 Injected Sequel

Kone millä tein harjoituksen:

AMD Ryzen 2600X Six-Core Processor 3.6 ghz  

16gb RAM  

Windows 10 Pro 64-bit käyttöjärjestelmä  

Oracle VM VirtualBox Manager

##

Läksy löytyy sivulta:  

https://terokarvinen.com/2023/eettinen-hakkerointi-2023/  

## x) Lue ja tiivistä  

#### https://terokarvinen.com/2016/03/05/postgresql-install-and-one-table-database-sql-crud-tutorial-for-ubuntu/


PostgreSQL Install and One Table Database – SQL CRUD tutorial for Ubuntu  

PostgreSQL tietokannan voi asentaa muutamalla rivillä:  

- `$ sudo apt-get -y install postgresql`
- `$ sudo systemctl start postgreql`
- `$ sudo -u postgres createdb $(whoami)`
- `$ sudo -u postgres createuser $/whoami)`
- `$ psql`  

#### https://owasp.org/www-project-top-ten/2017/A1_2017-Injection  
  
- Melkein minkä tyyppinen data tahansa voidaan käyttää harmilliseen injektioon  
- Usein injektio haavoittuvuudet on SQL, LDAP, XPath, NoSQL qweryt, OS komennot, XML parserit, SMTP headerit, expressio kieliet ja ORM queryt.  
-  Scannereilla ja fuzzereilla hyökkääjät löytää helposti injektio haavoittuvuuksia
-  Onnistunut haitallinen injektio voi johtaa datan menettämiseen, korruptoitumiseen, pääsyyn vääriin käsiin, kokonaiseen "takeoveriin"

#### https://portswigger.net/web-security/sql-injection  

- sql injektio on weppi turvallisuus-haavoittuvuus joka antaa hyökkääjän interferoida pyyntöjen kanssa mitä applikaatio tekee tietokannalle
- antaa hyökkääjälle mahdollisuuden nähdä dataa mitä ei muuten voisi nähdä
- mahdollisuuksia löytää haavoittuvuuksia (') `OR 1=1`, payloadit & suoritusajat
-  usein tapahtuu WHERE clausella SELECT querysta  mutta voi tapahtua muuallakin

#### https://portswigger.net/web-security/sql-injection/cheat-sheet  

- esimerkkejä hyödyllisistä syntaxeista SQL injektioita varten

## a) CRUD. Tee uusi PostgreSQL-tietokanta ja demonstroi sillä create, read, update, delete (CRUD). Keksi taulujen ja kenttien nimet itse. Taulujen nimet monikossa, kenttien nimet yksikössä, molemmat englanniksi.  

https://terokarvinen.com/2016/03/05/postgresql-install-and-one-table-database-sql-crud-tutorial-for-ubuntu/ käytin kyseistä artikkelia ohjeena tässä tehtävässä.  

`$ sudo apt-get update`  
`$ sudo apt-get -y install postgresql  
`$ sudo systemctl start postgresql`  
`$ sudo -u postgres createdb $(whoami)`    

Tähän tyssäs tuli virheilmoitus:  

![image](https://github.com/aarott/pentest23/assets/78908566/8927d719-06b9-4e84-aec3-420730135ddd)  

Menin /home kansiosta pois. Tein uuden postgresq kansion (vaikka en usko et tällaista tarvitseekaan)...  

`$ sudo mkdir postgresq`  
`$ sudo cd postgresq` 
`$ sudo -u postgres createdb $(whoami)`   

Nyt tuli ilmoitus että tällainen tietokanta on jo, käytetään sitten sitä.  

`$ psql`   

##  

![image](https://github.com/aarott/pentest23/assets/78908566/b52cae71-f4d0-4865-a376-926d1effdd39)  

##

![image](https://github.com/aarott/pentest23/assets/78908566/5c50e8fe-5b91-4f47-9455-075975fe10fa)  

Yritin lisätä tehdä uutta tablea mutta tulee ilmoitus "ERROR: permission denied for schema public".  

En löydä oikeen tapaa miten saada omalle käyttäjälleni oikeuksia käyttää postgresq tietokantaa, päätäin sitten kokeilla "postgresq" käyttäjällä. 

Etsin tietoa vähän ympäriinsä ja löysin artikkelin https://www.configserverfirewall.com/postgresql/installing-postgresql-on-ubuntu/   

`$ sudo su postgres`
`$ psql`  

`CREATE TABLE cars (id SERIAL PRIMARY KEY, brand VARCHAR(200), model VARCHAR(200);`  --> tää vihdoiin toimi ja siiryin tauolle  

Tässä välissä kokeilin vanhasta muistista lisäillä kenttiä  taulusta, tein virheitä ja en huomannut ottaa ruutukaappauksia. Siksi seuraavassa kuvassa taulukon id:t alkaa 4:sta koska poistin aiemmat 3.  

`\d` -> listaa relaatiot


##

![image](https://github.com/aarott/pentest23/assets/78908566/e2520c0f-47f2-4d30-abed-14a8707495ea)  

##  

Muokkasin ja poistin kenttiä:  

![image](https://github.com/aarott/pentest23/assets/78908566/ca31c8dc-03a6-48ad-9dd4-d8cd58d61368)  

## b) SQLi me. Kuvaile yksinkertainen SQL-injektio, ja demonstroi se omaan tietokantaasi psql-komennolla. Selitä, mikä osa on käyttäjän syötettä ja mikä valmiina ohjelmassa. (Tässä harjoituksessa voit vain kertoa koodista, ei siis tarvitse välttämättä koodata sitä ohjelmaa, joka yhdistää käyttäjän syötteen SQL:n)

Yksinkertainen SQL-injektoi voisi olla missä WHERE clausella päästään piilotetun datan sisälle. Kuten Portswigger labsin tehtävässä https://portswigger.net/web-security/sql-injection/lab-retrieve-hidden-data  

Tässä annettaisiin parametreille arvoksi `'+OR+1=1--` . Tämä tarkoittaa että WHERE clause vastaa "ei mitään" tai sitten 1=1 totuutta, joka toteutuu aina.  

Ohjelmassa tämä voisi olla esimerkiksi verkkosivuilla syötettä millä haetaan tietoa. Käsittääkseni tämä on HTTP GET REQUESTI. Tästä en ole aivan varma pyydettiinkö tätä tietoa mitä ohjelmassa jo on.  

Käyttäjän syöttämä SQL Injektio voisi tässä tapauksessa olla:  

`SELECT * FROM cars WHERE brand='' OR 1=1;`  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/5c3508a2-c8d5-4750-9b23-4820be8510a0)  

##  


## c) (Alakohta c poistettu, tämänhän ratkoimme jo aiemmin: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data)  

https://github.com/aarott/pentest23/blob/main/h-1.md#c-portswiggers-labs  

## d) SQL injection vulnerability allowing login bypass  

https://portswigger.net/web-security/sql-injection/lab-login-bypass  

Solution kohdassa on kerrottu vaihtaa `username` parametri ja antaa sille arvo: `administrator'-- 

Kirjoitin username kohtaan: administrator'--   

Salasana kohtaan voi kirjoittaa mitä vaan.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/c361bf7e-b177-4422-a4ec-8d1ff0410910)  

##  


## e) SQL injection attack, querying the database type and version on Oracle  

https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-oracle  

Tehtävässä pyydettiin käyttämään "UNION" hyökkäystä johonkin product caterogoryyn. Labran sivuilta klikkasin 'Accesories' kategoriaa ja Zapista katsoin requestia.  

Solutions kohdasta kävin katsomassa millaisen injektion tulee laittaa ja vaihdoin GET Requestin: ` '+UNION+SELECT+BANNER,+NULL+FROM+v$version-- `    

Avasin Manual Request editorilla ja vaihdoin GET requestin `...catergory='+UNION+SELECT+BANNER,+NULL+FROM+v$version--`  ja painoin Send.

##  

![image](https://github.com/aarott/pentest23/assets/78908566/e5eeff41-4b35-412d-a6f6-775e750303c8)  

##  

## f) SQL injection attack, querying the database type and version on MySQL and Microsoft  

https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-mysql-microsoft  

Tehtävässä pyydettiin käyttämään "UNION" hyökkäystä johonkin product caterogoryyn. Labran sivuilta klikkasin 'Accesories' kategoriaa ja Zapista katsoin requestia.  

Solutions kohdasta kävin katsomassa millaisen injektion tulee laittaa ja vaihdoin GET Requestin: '+UNION+SELECT+@@version,+NULL#  

Avasin Manual Request editorilla ja vaihdoin GET requestin `...catergory='+UNION+SELECT+@@version,+NULL# ` ja painoin Send. 

##

![image](https://github.com/aarott/pentest23/assets/78908566/574a2817-e8be-4b27-b8e0-73d3e917f9b9)  

## 

Unohdin edellisessä tehtävässä mikä oli samanlainen itse asiassa selvittää tietokannan versiotyypin. En löytänyt tätä itse, joten katsoin https://www.youtube.com/watch?v=4UxUpsCZQfI läpikävelyvideon lopusta miten tietokannan versiotyyppi löytyy.  

Response ikkunasta voi avata vastauksen selaimesta mistä löytyy tietoa versiotyypistä. Tässä tapauksessa se on MySQL tietokanta Ubuntulla.   

##

![image](https://github.com/aarott/pentest23/assets/78908566/82add4f0-fd3b-4559-a2af-8ffb616e2b9f)  

##  

## g) SQL injection attack, listing the database contents on non-Oracle databases

https://portswigger.net/web-security/sql-injection/examining-the-database/lab-listing-database-contents-oracle

Tässä tehtävässä käytin taas kokonaan Solutions ratkaisua eri vaiheiden tekemiseen. Pelkästä Hints vinkeistä ja Cheat Sheetistä ei tässä vaiheessa ole vielä apua...  

Solutions kohdasta kävin katsomassa millaisen injektion tulee laittaa, että voidaan listata kaikki tietokannan taulut ja vaihdoin GET Requestin: ` '+UNION+SELECT+table_name,NULL+FROM+all_tables--  `

##  

![image](https://github.com/aarott/pentest23/assets/78908566/3069d775-2d07-4dfe-b79e-5d82f6302801)  

##  

Vastauksena tulee kaikki tietokannan taulukot:  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/e36c6c3a-a1bf-4078-889f-334bcd3892ac)  

##  

Nyt muutetaan GET Requestia näyttämään Users taulukosta kaikki kolumnit: ` '+UNION+SELECT+column_name,NULL+FROM+all_tab_columns+WHERE+table_name='USERS_ABCDEF'-- `

##  

![image](https://github.com/aarott/pentest23/assets/78908566/a92c1405-c05a-4903-9d34-d60c708a1f5e)  

##

En oikeestaan ymmärtänyt miksi tämä oli olennaista. Koska seuraavassa vaiheessa GET Requestilla haetaan myös salasanat.  

Muutetaan GET Requestia näyttämään myös salasanat: ` '+UNION+SELECT+USERNAME_ABCDEF,+PASSWORD_ABCDEF+FROM+USERS_ABCDEF-- `  

##

![image](https://github.com/aarott/pentest23/assets/78908566/ab7cc262-0f3f-48be-a1d5-10e3382cfc29)  

##  

Response antaa "500 Internal Server Erroria".  Tästä olisi vinkkien mukaan pitänyt löytyä salasana, jätän tehtävän kesken koska en keski syytä miksi tämä ei toimi.  

![image](https://github.com/aarott/pentest23/assets/78908566/10c86b21-4049-46cf-a0c5-4601b7c48b29)  


## 

Katsoin https://www.youtube.com/watch?v=ZbwIbIq5-eE läpikävelyohjeen loppuosan ja huomasin että USERS kohtaan piti tosiaan kolumneista ottaa arvo... tietenkin.  Niinpä palasin vähän taaksepäin.  

Vaihdoin GET Requestin: ` '+UNION+SELECT+table_name,NULL+FROM+all_tables--  `  

Nyt repsponsesta löytyy alhaalta USERS_IREJAO . Kokeilen sitä seuraavassa kohdassa.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/b38b1dab-4ea1-4396-a0c0-d46f35dd8614)

![image](https://github.com/aarott/pentest23/assets/78908566/b492eb05-ce55-425b-bd1b-45c572b984f2)    

##  

Nyt responsesta löytyy password ja username.  

![image](https://github.com/aarott/pentest23/assets/78908566/2eb9881b-9f96-42ef-acb9-3a097a6a90fc)  

##  

Muokkasin GET requestiin nyt passwordin ja usernamen. Vastaukseksi tulee HTTP OK/200, päätän avata selaimella sivun ja se sisältää kirjautumistietoja.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/5d360bd2-5d25-4e1a-92be-05044fc216df)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/5490cb9f-dc6d-406c-ae42-603240023a65)  

##  

Kirjaudun My account kohdasta Administratorilla sisään ja laitan salasanan edelliseltä sivulta. Pääsen sisään ja Lab on Solved.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/0e61a6e5-9012-4807-afc5-4f50577d44dc)  

##  

## h) SQL injection UNION attack, determining the number of columns returned by the query

https://portswigger.net/web-security/sql-injection/union-attacks/lab-determine-number-of-columns  

Tässä tehtävässä laitetaan SQL injektion perään "NULL" kohtia niin monta kertaa kunnes ERROR katoaa, sillä tavoin saamme tietoon kuinka monta kolumnia on. 

GET Requestin parametriin laitetaan: '+UNION+SELECT+NULL-- 

Ensimmäinen yritys ja tuloksena 500 INTERNAL ERROR.  

## 

![image](https://github.com/aarott/pentest23/assets/78908566/05f79092-6eb4-48a5-8cb8-12074a8f0572)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/b44b23e9-907e-4c64-b595-1c9e1f490adb)  

##  

Tehdään uusi GET Requesti ja lisätään NULL edellisen perään: '+UNION+SELECT+NULL,NULL--  

Sekään ei toimi mutta kolmas kerta toimii koska saadaan HTTP /200 OK responseksi.  

'+UNION+SELECT+NULL,NULL,NULL--   


##  

![image](https://github.com/aarott/pentest23/assets/78908566/7db22551-3d62-4932-84f0-688b65836bfb)


![image](https://github.com/aarott/pentest23/assets/78908566/c85c6ad8-decd-429d-ac0f-5c223af6c501)   


![image](https://github.com/aarott/pentest23/assets/78908566/35d59431-2a81-48d1-acc4-1d838193528c)


##  

Tämä siis tarkoittaa, että kolumneja GET-queryllä tulee kolme kappaletta takaisin.  


## i) SQL injection UNION attack, retrieving data from other tables  

https://portswigger.net/web-security/sql-injection/union-attacks/lab-retrieve-data-from-other-tables

Tässä tehtävässä on tarkoitus löytyää tietokonnasta users taulukko, minkä kolumnit sisältää käyttäjän ja salasanan.  

Solutions kohdasta saa taas vinkin eka laittaa GET QUERYN product catergoryn perään: `'+UNION+SELECT+'abc','def'--`  

Tällä vaan tarkistetaan, että Query vastaa kahta kolumnia.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/67a85c41-f7d6-4afc-8047-b9c750d1790a)  

![image](https://github.com/aarott/pentest23/assets/78908566/d852192d-f281-4553-8ffa-ea0dff422951)  

##  

Nyt haetaan käyttäjät ja salasanat laittamalla Get Queryn perään:  `'+UNION+SELECT+username,+password+FROM+users--`

##  

![image](https://github.com/aarott/pentest23/assets/78908566/23ab7208-6dd2-424f-a2ec-979c913b105a)  

##  

Responsesta ne löytyykin nyt:  

![image](https://github.com/aarott/pentest23/assets/78908566/593481f4-9fba-47d7-98dd-bbc4b554221a)  

Kyseisillä administrator käyttiksillä ja salasanalla pääsin sisään ja lab solved:  

![image](https://github.com/aarott/pentest23/assets/78908566/457d2084-fd1c-4386-ae74-7bfedcb5790f)  

##  

















