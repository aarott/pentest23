# h5 Injected Sequel

Kone millä tein harjoituksen:

AMD Ryzen 2600X Six-Core Processor 3.6 ghz  

16gb RAM  

Windows 10 Pro 64-bit käyttöjärjestelmä  

Oracle VM VirtualBox Manager

##

Läksy löytyy sivulta:  

https://terokarvinen.com/2023/eettinen-hakkerointi-2023/  

## x) Lue ja tiivistä  

#### https://terokarvinen.com/2016/03/05/postgresql-install-and-one-table-database-sql-crud-tutorial-for-ubuntu/


PostgreSQL Install and One Table Database – SQL CRUD tutorial for Ubuntu  

PostgreSQL tietokannan voi asentaa muutamalla rivillä:  

- `$ sudo apt-get -y install postgresql`
- `$ sudo systemctl start postgreql`
- `$ sudo -u postgres createdb $(whoami)`
- `$ sudo -u postgres createuser $/whoami)`
- `$ psql`  

#### https://owasp.org/www-project-top-ten/2017/A1_2017-Injection  
  
- Melkein minkä tyyppinen data tahansa voidaan käyttää harmilliseen injektioon  
- Usein injektio haavoittuvuudet on SQL, LDAP, XPath, NoSQL qweryt, OS komennot, XML parserit, SMTP headerit, expressio kieliet ja ORM queryt.  
-  Scannereilla ja fuzzereilla hyökkääjät löytää helposti injektio haavoittuvuuksia
-  Onnistunut haitallinen injektio voi johtaa datan menettämiseen, korruptoitumiseen, pääsyyn vääriin käsiin, kokonaiseen "takeoveriin"

#### https://portswigger.net/web-security/sql-injection  

- sql injektio on weppi turvallisuus-haavoittuvuus joka antaa hyökkääjän interferoida pyyntöjen kanssa mitä applikaatio tekee tietokannalle
- antaa hyökkääjälle mahdollisuuden nähdä dataa mitä ei muuten voisi nähdä
- mahdollisuuksia löytää haavoittuvuuksia (') `OR 1=1`, payloadit & suoritusajat
-  usein tapahtuu WHERE clausella SELECT querysta  mutta voi tapahtua muuallakin

#### https://portswigger.net/web-security/sql-injection/cheat-sheet  

- esimerkkejä hyödyllisistä syntaxeista SQL injektioita varten

## a) CRUD. Tee uusi PostgreSQL-tietokanta ja demonstroi sillä create, read, update, delete (CRUD). Keksi taulujen ja kenttien nimet itse. Taulujen nimet monikossa, kenttien nimet yksikössä, molemmat englanniksi.  

https://terokarvinen.com/2016/03/05/postgresql-install-and-one-table-database-sql-crud-tutorial-for-ubuntu/ käytin kyseistä artikkelia ohjeena tässä tehtävässä.  

`$ sudo apt-get update`  
`$ sudo apt-get -y install postgresql  
`$ sudo systemctl start postgresql`  
`$ sudo -u postgres createdb $(whoami)`    

Tähän tyssäs tuli virheilmoitus:  

![image](https://github.com/aarott/pentest23/assets/78908566/8927d719-06b9-4e84-aec3-420730135ddd)  

Menin /home kansiosta pois. Tein uuden postgresq kansion (vaikka en usko et tällaista tarvitseekaan)...  

`$ sudo mkdir postgresq`  
`$ sudo cd postgresq` 
`$ sudo -u postgres createdb $(whoami)`   

Nyt tuli ilmoitus että tällainen tietokanta on jo, käytetään sitten sitä.  

`$ psql`   

##  

![image](https://github.com/aarott/pentest23/assets/78908566/b52cae71-f4d0-4865-a376-926d1effdd39)  

##

![image](https://github.com/aarott/pentest23/assets/78908566/5c50e8fe-5b91-4f47-9455-075975fe10fa)  

Yritin lisätä tehdä uutta tablea mutta tulee ilmoitus "ERROR: permission denied for schema public".  

En löydä oikeen tapaa miten saada omalle käyttäjälleni oikeuksia käyttää postgresq tietokantaa, päätäin sitten kokeilla "postgresq" käyttäjällä. 

Etsin tietoa vähän ympäriinsä ja löysin artikkelin https://www.configserverfirewall.com/postgresql/installing-postgresql-on-ubuntu/   

`$ sudo su postgres`
`$ psql`  

`CREATE TABLE cars (id SERIAL PRIMARY KEY, brand VARCHAR(200), model VARCHAR(200);`  --> tää vihdoiin toimi ja siiryin tauolle  

Tässä välissä kokeilin vanhasta muistista lisäillä kenttiä  taulusta, tein virheitä ja en huomannut ottaa ruutukaappauksia. Siksi seuraavassa kuvassa taulukon id:t alkaa 4:sta koska poistin aiemmat 3.  

`\d` -> listaa relaatiot


##

![image](https://github.com/aarott/pentest23/assets/78908566/e2520c0f-47f2-4d30-abed-14a8707495ea)  

##  

Muokkasin ja poistin kenttiä:  

![image](https://github.com/aarott/pentest23/assets/78908566/ca31c8dc-03a6-48ad-9dd4-d8cd58d61368)  

## b) SQLi me. Kuvaile yksinkertainen SQL-injektio, ja demonstroi se omaan tietokantaasi psql-komennolla. Selitä, mikä osa on käyttäjän syötettä ja mikä valmiina ohjelmassa. (Tässä harjoituksessa voit vain kertoa koodista, ei siis tarvitse välttämättä koodata sitä ohjelmaa, joka yhdistää käyttäjän syötteen SQL:n)

Yksinkertainen SQL-injektoi voisi olla missä WHERE clausella päästään piilotetun datan sisälle. Kuten Portswigger labsin tehtävässä https://portswigger.net/web-security/sql-injection/lab-retrieve-hidden-data  

Tässä annettaisiin parametreille arvoksi `'+OR+1=1--` . Tämä tarkoittaa että WHERE clause vastaa "ei mitään" tai sitten 1=1 totuutta, joka toteutuu aina.as 

Ohjelmassa tämä voisi olla esimerkiksi verkkosivuilla syötettä millä haetaan tietoa. Käsittääkseni tämä on HTTP GET REQUESTI. Tästä en ole aivan varma pyydettiinkö tätä tietoa mitä ohjelmassa jo on.  

Käyttäjän syöttämä SQL Injektio voisi tässä tapauksessa olla:  

`SELECT * FROM cars WHERE brand='' OR 1=1;`  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/5c3508a2-c8d5-4750-9b23-4820be8510a0)  

##  


## c) (Alakohta c poistettu, tämänhän ratkoimme jo aiemmin: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data)  

https://github.com/aarott/pentest23/blob/main/h-1.md#c-portswiggers-labs  

## d) SQL injection vulnerability allowing login bypass  

https://portswigger.net/web-security/sql-injection/lab-login-bypass  

Solution kohdassa on kerrottu vaihtaa `username` parametri ja antaa sille arvo: `administrator'-- 

Kirjoitin username kohtaan: administrator'--   

Salasana kohtaan voi kirjoittaa mitä vaan.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/c361bf7e-b177-4422-a4ec-8d1ff0410910)  

##  


## e) SQL injection attack, querying the database type and version on Oracle  

https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-oracle  

Tässä pyydettiin käyttämään "UNION" hyökkäystä johonkin product caterogoryyn. Labran sivuilta klikkasin 'Accersories' kategoriaa ja Zapista katsoin requestia.  

Solutions kohdasta kävin katsomassa millaisen injektion tulee laittaa ja vaihdoin GET Requestin: ` '+UNION+SELECT+BANNER,+NULL+FROM+v$version-- `  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/e5eeff41-4b35-412d-a6f6-775e750303c8)  

##  


















