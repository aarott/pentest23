# h6 Attaaack

Kone millä tein harjoituksen:

AMD Ryzen 2600X Six-Core Processor 3.6 ghz  

16gb RAM  

Windows 10 Pro 64-bit käyttöjärjestelmä  

Oracle VM VirtualBox Manager

##

Läksy löytyy sivulta:  

https://terokarvinen.com/2023/eettinen-hakkerointi-2023/  

## x) Lue/katso/kuuntele ja tiivistä  

€ Yehoshua and Kosayev 2021: Antivirus Bypass Techniques, luku:
Chapter 1: Introduction to the Security Landscape  

- Nykypäivän digitaalisessa maailmassa yksinkertaisin ja suosituin tapa suojautua on antivirus-ohjelmat  
- Eri tyyppisiä malware (malicious file) kuten esim trojan, virus, ransomware jne pitää tunnistaa, että ymmärretään miten pääsee anti-virus ohjelman läpi  
- Muita suojautumiskeinoja palomuurit, EDR, IDS/IPS, DLP
- Anti-virus ohjelmilla on erilaisia moottoreita tunnistamaan haittaohjelmat kuten: static, dynamic, heuristic ja unpacking engine)  
- O'Reillyn tutkimus läpäistä antivirus-ohjelma on totetutettu pakatuilla EXE tiedostoilla ja kommunikaatio blind/reverse shellillä

Halonen, Rajala ja Ollikainen 2023: PhishSticks Youtube Channel, kahdeksan videota, yhteensä noin 15 min  

- Haaga-Helia infraprojektin ryhmä  
- Flipperzerolla tehty  reverse shell 
- Digispark ransomware  
- Digispark keylogger  
- Bad/USB esittelyvideo

Halonen, Rajala ja Ollikainen 2023: PhishSticks Git Repository  

- Readme.md sisältää projektin esittelyn sekä viikottaisen raportin miten projekti on edistynyt  
- Mitigations.md esitelty tapoja miten suojautua Phisticksin kaltaisilta hyökkäyksiltä (Disable powershell from user / Windows Firewall block powershell / Ransomware protection - controlled folder access)   
- Reverse shell toiminta: kun Company pikalinkkiä klikataan, se lataa "väärennetyn" raport.txt tiedoston ja netcatin hyökkääjää varten. Kohde tietokone soittaa Netcatilla hyökkääjän koneeseen mikä saa auki reverseshellin kohteeseen

Installing Windows 10 on a virtual machine  

-  https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterprise  ilmainen windows .iso tiedosto valitaan (Great Britain 64-bit not LTSC)
-  VirtualBoxilla asennus: 50gb kovalevytilaa, 4 CPU, 8 GB muistia
-  WIndows asennus: region Finland, Domain Join Instead  
-  VirtualBoxista uusi Host-Only adapteri missä laitetaan Windows ja hyökkäävä kone samaan host-only verkkoon
-  Verkkoa voi testata pingaamalla toista konetta (ip-osoitteet saa ipconfig / ifconfig)


MITRE Att&ck Frequently Asked Questions: Part 1. General  

- tactics: tarkoitetaan sanalla "miksi" jotain tekniikkkaa tai alitekniikkaa käytetään. Syy hyökkäykselle, esim sisäänkirjautuminen  
- techniques: tarkoitetaan sanalla "miten" hyökkääjä onnistuu saamaan haitallisen tekniikan tehdyksi
- procedures: spesifistejä tapoja miten tekniikoita ja alitekniikoita käytetään hyökkäysten tekoon

MITRE Att&ck Enterprise Matrix  
  
muutama esimerkki:  

-  Reconnaisance : active scanning - Scanning IP blocks - voi olla esimerkiksi Nmap skannausta
-  Resource Development: Compromise Accounts - E-mail Accounts - voi olla esimerkiksi phishing sähköposteja
-  Execution: Command and scripting interpreter - Windows / Unix comman shell - voi olla esimerkiksi reverse shellin käyttö
-  Execution: User Execution - Malicious file - vähän kuten PhishSticksin .txt tiedosto mikä avaa haittohjelman taustalle

## a) The OS pwns you. Asenna Windows virtuaalikoneeseen samaan verkkoon hyökkäyskoneen (esim. Kali, Debian) kanssa. Kokeile, että saat koneen irrotettua Internetistä.  

Asennettu https://github.com/therealhalonen/PhishSticks/blob/master/notes/ollikainen/windows.md ohjeet luettuani.  

Latasin Windows .iso tiedoston https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterprise sivulta.  

Valitsin UK GB - 64 Bit not LTSC version.    

VirtualBoxista: New -->
Name: Windows  
Memory: 8192MB  
CPU: 4 CPU  
New Virtual Disc: 50GB   

##  

![image](https://github.com/aarott/pentest23/assets/78908566/97510de6-098b-4dc6-a23b-3a0e530072a6)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/5a82bc0c-810c-43c0-826b-f2a2894d5185)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/a647d35e-9172-4665-b05d-d00021268822)  

Ei menny kuin olisin kuvitellut. Kokeillaan kohta tekemällä uusiksi.  

##  

Restarttasin koneen, poistin vanhan luoman kansion Windowsta varten ja loin taas uuden samoilla asetuksilla VirtualBoxista. Nyt pääsin asentelemaan.  

Kieleksi Englanti, Region ja Language Finnish.  

Custom Install - >   

Ei kirjauduta Microsoft tunnuksilla vaan painetaan Domain join instead.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/ab4cc195-f736-47b1-b9f2-1915f21b0db5)  

##  

Windows on nyt asennettu: 

##

![image](https://github.com/aarott/pentest23/assets/78908566/5f4135b5-9031-4f23-a58d-34196af5325e)  

##  

Suljin Windows virtuaalikoneen. Menin VirtualBoxin Windows koneen settings -> Network - > Adapter 2 - > Host-only Adapter (tähän sama adapteri kun mulla on Kali Linux kone)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/c4032513-2747-4d5b-b14c-26959a07d294)  

##  


Käynnistin sen jälkeen Windowsin uudestaan ja katsoin, että Host-only network toimii Kali Linuxin ja Windows välillä. Katsoin Windows koneen IP-osoitteen comman promptista `ipconfig` komennolla ja sen jälkeen pingasin sitä Kalilla.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/26a92009-e693-4ced-ba0c-83967d506c4d)  

##  

Yhteys onnistuu ja Hosy-Only verkko toimii koska paketit menee Kali Linuxilkta Windows koneelle perille. Syy miksi Windows ei vastaa voi johtua esimerksi palomuurin asetuksista.  

Huom ! Pitää muistaa nyt kytkeä molemmat koneet pois netistä (Network Adapter 1, Cable Disconnected)  jos erilaisia hyökkäyksiä haluaa kokeilla.  Kokeilin Kalilla pingata google.com ja testasin myös selaimesta, että netti ei tosiaan toimi.

##  


![image](https://github.com/aarott/pentest23/assets/78908566/a16a07af-f89c-4754-a5f0-45671d50788b)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/f3a602f8-e042-4e33-a27d-4469db143011)  

##  


## b) Trustme.lnk. Kokeile PhishSticksin revshell vihamielistä tiedostoa, joka avaa käänteisen shellin hyökkääjän koneelle. Selitä, mitä tapahtuu ja miksi. Testaa, että pysyt antamaan kohdekoneelle komentoja reverse shellin kautta.  

https://www.youtube.com/watch?v=ll4ojo6q-rM  

Videolta näytti alkuun selkeeltä miten tämän tehtävän saisi tehtyä. En kuitenkaan ymmärrä miten hyökkäys koneella tuo raport.txt ja nc64.exe pitäisi hostata. Luulin, että siihen olisi GitHubissa myös ladattava kansio mistä ne löytyisi suoraan. Netcat64.exe on Windows ohjelma, pitääkö se ladata jostain Kali Linuxille ja luoda tuohon kansioon? Katson myöhemmin Sawulohi raportista ja tulen päivittämään tänne.  

##  c) Attaaack! MITRE Attack Enterprise Matrix: Demonstroi viisi tekniikkaa viidestä eri taktiikasta  

Olen asentanut Metasploitable 2 harjoitusmaalin samaan Host-Only verkkoon Kali Linuxin kanssa.  

Metasploitable 2 on osoitteessa:  192.168.78.4  

Samassa verkossa on myös Windows kone harjoitusmaalina osoitteessa:

Kaikki koneet on kytketty testauksien ajaksi pois internetistä.  



#### Taktiikka: Reconnaisance , Tekniikka: Active Scanning: Wordlist Scanning (ID:T1595.003)  

https://attack.mitre.org/techniques/T1595/003/  

Tämän tekniikan aikeena on brute force menetelmää käyttäen löytämään sisältöä ja infrastruktuuria hyökättävästä kohteesta.  

Skannataan Metasploitable2 palvelimen weppisivun hakemistoja /dvwa sivun alta.  http://192.168.78.4/dvwa  

Käytetään FFuf työkalua mikä on kätevä hyökättävän kohteen sisällön löytämiseksi.   

` $ ffuf -w /usr/share/seclists/Discovery/Web-Content/common.txt -u http://192.168.78.4/dvwa/FUZZ`  

Ffuf on työkalu mitä käytetään  
-w = wordlist  
-u = osoite mitä skannataan  

## 

![image](https://github.com/aarott/pentest23/assets/78908566/2630818f-72f9-49d1-80f4-0fc3c6edcf6f)  

## 

Voidaan huomata, että http://192.168.78.4/dvwa/ löytyy useampi tiedosto ja hakemisto mikä löytyy wordlistasta.  
Tässä käytetään HTTP GET methodia ja Matcherina on yleisempiä HTTP Response statuksia.  

##  

#### Taktiikka: Discovery, Tekniikka: Network Service Discovery (ID: T1046)  

https://attack.mitre.org/techniques/T1046/

Tämän tektiikan aikeena on skannata eri palveluita mitkä on kohteessa käynnissä ja mahdollisesta haavoittuvaita.  
Yleisin metodi tähän on porttiskannaus.  

Päätin porttiskannata Windows koneen nähdäkseni mitä palveluita siellä on käynnissä. 

`nmap -A ip` 

nmap = porttiskannaus työkalu
-A = agressiivinen laaja skannaus  

Tarkistin varmuuden vuoksi ip osoitteen koneesta uudelleen ja että kone on varmasti kytketty pois netistä: 

`ipconfig` 

## 

![image](https://github.com/aarott/pentest23/assets/78908566/65c18b97-18d8-4a76-99b6-12fcbfbbe27f) 

## 

![image](https://github.com/aarott/pentest23/assets/78908566/a1169787-de15-405d-975b-d99b80b2fb63)  

##

Windows ei tosiaan vastaa porttiskannaukseen millään tavoin (Host seems down). Tämä johtuu varmaan Windowsin hyvästä palomuurista.  

Nmap -Pn (kehottaa ajamaan tämän, en löytänyt -Pn manuaalista selitettä) löytää kuitenkin Windows hostin.  Samoin pingaamalla nähdään, että kone vastaa.  

















