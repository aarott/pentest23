# h4 Totally Legit Sertificate

Kone millä tein harjoituksen:

AMD Ryzen 2600X Six-Core Processor 3.6 ghz  

16gb RAM  

Windows 10 Pro 64-bit käyttöjärjestelmä  

Oracle VM VirtualBox Manager

##

Läksy löytyy sivulta:  

https://terokarvinen.com/2023/eettinen-hakkerointi-2023/  

## x) Lue ja tiivistä  

https://owasp.org/Top10/A01_2021-Broken_Access_Control/ A01:2021 – Broken Access Control  

- access control tarkoittaa että käyttäjät eivät voi toimia omien käyttöoikeuksien ulkopuolella  
- kun access control pettää se voi johtaa tiedon väärinkäyttöön  

Esimerkkejä broken access controllista: 

- käyttöoikeuksien hallinnan väärinkäyttö  
- URL parametrien muokkaus (force browsing)  
- API:n käyttäminen POST,PUT,DELETE toiminnoilla jotka ei ole sallittuja  
- Metadata manipulaatio  
- Toisena käyttäjänä tai adminina esiintyminen  

Miten voidaan estää: 
  
- tarkat käyttöoikeuksien määritelmät  
- käyttöoikeuksia ei pysty muokkaamaan helposti  
- Domain mallinnuksella voidaan rajata pääsy tiettyihin rajoihin  
- Käyttöoikeuksien logittaminen ja ilmoitus adminille  
- Web server directory ja metadatan poistaminen rootista  
- API / Controller access rajoittaminen automaattisen hyökkäyksen suojautumiseksi

##

https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/  A10:2021 – Server-Side Request Forgery (SSRF)  

- SSRF tapahtuu kun webbiapplikatio hakee etäresursseja ilman että validoi käyttäjän antamaa URL-osoitetta  
- voi tapahtua vaikka käytössä on palomuuri tai VPN   

Esimerkkejä:   
  
- sisäisten servereiden porttiskannaus  
- sensitiiviseen dataan pääsy sisäisessä verkossa (localhost)  
- metadatan pääsy pilvipalveluissa  
- sisäisten järjestelmien haavoittaminen (DOS), (RCE)

##


https://portswigger.net/web-security/access-control  
  
- access controll on käyttäjien ja käyttöoikeuksien hallintaa  
- vertical access control: eri käyttäjillä eiri oikeudet eri applikaation funktioihin  
- horizontal access control: käyttäjillä on pääsy vaan tiettyjen käyttäjien resursseihin (omiin yleensä), hyökkäys esim IDOR (insercure object reference)  
- context- dependent access controls:  estää käyttäjien tekemästä toimenpiteitä väärässä järjestyksessä  

##  

https://portswigger.net/web-security/server-side-template-injection  
  
- tapahtuu kun hyökkääjä pääsee käyttämäään natiivia template syntaxia laittaakseen ilkeämielisen payloadin mikä suoritetaan palvelimen puolella  
- tapahtuu kun käyttäjän inputti laitetaan suoraan templateen, eikä datana  
- vaarallisempaa kuin käyttäjäpuoleinen injektio, koska tapahtuu palvelimen puolella  

##  
  
https://portswigger.net/web-security/ssrf  


-SSRF (server-side request forgery) tapahtuu kun hyökkääjä pääsee tekemään palvelimen puolella toimivasta applikaatiosta pyynnön paikasta mihin ei tulisi olla pääsyä
- saattaa pystyä saamaan palvelimen yhdistämään ulkopuolisiin haittalisiin järjestelmiin    

##  

https://portswigger.net/web-security/cross-site-scripting  
  
- tapahtuu kun hyökkääjäällä on mahdollisuus päästä vaarantamaan käyttäjien tavallisen interaktiot jonku applikaation kanssa  
- hyökkääjä pystyy manipuloimaan nettisivua niin, että se lähettää ilkeämielistä Javascript koodia käyttäjille, kun käyttäjä ajaa tämän koodin se antaa pääsyn hyökkääjälle vaikuttamaan applikaation interaktioon  
- suurin osa XSS hyökkäyksistä pystyy löytämään Burp Suiten web vulnerability scannerilla  
- voidaan estää filtteröimällä syötettyä dataa, koodamaalla outputin dataa, käyttämällä oikeanlaisia response headereita, content security policeilla  
  
Kolme eri tyyppistä XSS hyökkäystä:  
  
- Reflected XSS, kun ilkeämielinen scripti tulee HTTP requestillä  
- Stored XSS, kun ilkeämielinen scripti tulee nettisivun tietokannasta    
- DOM-based XSS, kun haavoittuvuus on käyttäjän puolella, sen sijaan että se olisi palvelimella

##

https://terokarvinen.com/2023/webgoat-2023-4-ethical-web-hacking/  

Ohjeet WebGoat 2023.4 asennukseen:  

- Javan ja palomuurin asennus (`$ sudo apt-get install openjdk-17-jre`) ; (`$ sudo apt-get install ufw` ; `$ sudo ufw enable`)
- JAR tiedoston lataus Webgoatin Github sivustolta (`$ wget https://github.com/WebGoat/WebGoat/releases/download/v2023.4/webgoat-2023.4.jar`)  
- Webgoat portin muuttaminen, että se ei ole sama kuin esim OWAS ZAP, `($ java -Dfile.encoding=UTF-8 -Dwebgoat.port=8888 -Dwebwolf.port=9090 -jar webgoat-2023.4.jar`)  
- Webgoatin URL ja admin salasana löytyy standard outputilta  
- Testaa menemällä sivulle http://127.0.0.1:8888/WebGoat

##  

## a) Totally Legit Sertificate. Asenna OWASP ZAP, generoi CA-sertifikaatti ja asenna se selaimeesi. Laita ZAP proxyksi selaimeesi. Osoita, että hakupyynnöt ilmestyvät ZAP:n käyttöliittymään. (Ei toimi localhost:lla ilman Foxyproxya  

Päätin tehdä tämän tehtävän käyttäen Teron sivun tehtävän vinkeissä olevaa https://kulonpaa.com/?p=338 raporttia apuna.  
Omassa Kali Linuxissa ei ollut OWASP ZAPPia asennettuna, niinpä katsoin https://www.kali.org/tools/zaproxy/ ohjeet asennukseen.  

`sudo apt-get update`  
`sudo apt-get upgrade`   
`sudo apt-get install -y zaproxy`   

![image](https://github.com/aarott/pentest23/assets/78908566/2dd0026a-2555-4e07-a3e1-bcc70843cad7)  

##  

Tällainen tuli asennuksen aikana, ei tietoa mihin liittyy mutta painoin `Enter` jatkaakseni ja asennus ajoi loppuun.  

Avasin ensimmäisen kerran Zapin etsimällä sen sovelluksista kirjoittamalla hakuun ZAP.  Valitsin ensimäisessä ikkunassa ekan vaihtoehdon kuten kuvassa ja painoin Start.  

Seuraavassa ikkunassa valitsin Update All ja valitsin myös kohdan että asentaa Custom Payloadsit.  

![image](https://github.com/aarott/pentest23/assets/78908566/bacad5d4-251e-44a1-966d-c7f7eb118748)  

##  

Menin Tools -> Options -> Local Proxies -> Go to New Screen  

Tähän muutin localhostin porttia 8080 -> 8081 syystä että WebGoat tulee pyörimään portissa 8080.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/7d90d77c-f1e4-4ed5-861d-77687c72a31f)  

##  

Samasta Options valikosta valitsin -> Dynamic SSL Certificates -> Go to New Screen -> Generate -> Save  

##

![image](https://github.com/aarott/pentest23/assets/78908566/4f2ffee1-65fb-495d-b6d3-fad2218a0946)  

##  


Seuraavaksi menin Firefoxiin, oikeesta yläreunasta valitsin Settings, seuraavalta sivulta Privacy & Security.  

Jonku matkaa piti scrollata alaspäin niin löytyi kohta mitä painaa -> View Certificates  


![image](https://github.com/aarott/pentest23/assets/78908566/c9c78034-6dbb-41a1-92a9-e0caca92ae85)  

##

Seuraavaksi Authorities -> Import -> zap_root_ca.cer -> ruksasin kohdan Trust this CA to identify websites ja OK

![image](https://github.com/aarott/pentest23/assets/78908566/f8f7329f-35a8-4ce5-8fd1-769cb0918488)


## 

Menin Firefoxiin ja yritin avata jotain nettisivua mutta en saanut hakupyyntöjä ilmestymään ZAP sovellukseen. Asennan seuraavassa tehtävssä FoxyProxy ja katson mitä tapahtuu.  

https://rkhal101.github.io/_posts/WAVS/ZAP/zap_browser_setup  -> ZAP tutorialista huomasin, että Firefoxin Network asetuksia pitää myös muuttaa.  

Settings --> General --> Network settings -> Manual Proxy configuration -> Also use this proxy for HTTPS  

##  


![image](https://github.com/aarott/pentest23/assets/78908566/ab0d0296-da09-4a04-9afb-e2503b13a244)  

##  

Nyt toimii, testasin menemällä Hesarin nettisivulle.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/e8e8e307-d5f5-4a31-9975-aae2ace7bbc7)  

##  



Zap

##  b) Kettumaista. Asenna FoxyProxy Standard Firefox Addon, ja lisää ZAP proxyksi siihen.  

Käytin https://kulonpaa.com/?p=338 raporttia ohjeena FoxyuProxy asennukseen.  

Menin Firefoxysta Add-Ons -> Search -> Foxy -> Foxyproxy standard - > Add to Firefox  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/62b4e1b2-4736-44d1-ab05-6caa411359da)  

## 

FoxyProxy options -> Add + -> tähän Zapin tiedot Localhost ja portti 8081  -> Save  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/c9aab70d-fce0-4be8-8a65-5f9849547fdf)  

##  

Kokeilin nyt Metasploitable2 sivustoa niin, että Zap on proxyna selaimessa. Menin Metasploitable 2 osoitteeseen selaimesta ja Zappiin ilmestyi onnistuneesti hakupyynöt.  

##

![image](https://github.com/aarott/pentest23/assets/78908566/93864730-c664-49be-acc5-da59fce7985e)  

##  

## c) Insecure direct object references  https://portswigger.net/web-security/access-control/lab-insecure-direct-object-references  


Menin tekemään tehtävää, ratkaiusssa on vinkki miten tehtävä tulee suorittaa:  

##

![image](https://github.com/aarott/pentest23/assets/78908566/b4310c61-60d6-43e7-8483-524adc89e0b5)  

##

Avasin ZAP sovelluksen ja laitoin uuden session päälle.  
Avasin Labran, menin Live Chat tabista chatti ikunaan ja kirjoitin viestiksi Moi ja painoin View Transcript.
Huomasin, että sivusto latasi tekstitiedoston. ZAPista menin download transcript kuvakkeen alle missä oli tuo GET: 9.txt tiedosto, tätä tulisi muokata 1.txt tiedostoksi.  
Klikkasin GET: 9.txt requestia ja avasin Manual Request editorin, muokkasin loppuosan vastaavman 1.txt tiedostoa kuten kuvassa alla ja painoin Send.  

##

![image](https://github.com/aarott/pentest23/assets/78908566/02120f8e-bc74-48f3-b00a-4ac69d50480f)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/0d24c13f-8c99-4e98-9069-cc1c021448f0)  

##    

Nyt download transcript kansion alle on tullut GET: 1.txt requesti. Klikkasin ja laitoin sen avautumaan Open URL in System Browser, jonka jälkeen selaimeen latautui 1.txt tiedosto joka sisälsi salasanan.  

##

![image](https://github.com/aarott/pentest23/assets/78908566/241a3ff4-d353-4800-9e7d-8a9aa2061fb9)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/8229fd1d-3a92-485a-af16-b4f010a5ea87)  

##  

Sen jälkeen kirjauduin My account kohdasta carlos käyttäjänimellä ja tekstiedostosta löytyneellä salasanalla sisään.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/872f5e4b-5817-43eb-83c0-4fb19698b350)  

##

## d) File path traversal, simple case https://portswigger.net/web-security/file-path-traversal/lab-simple

## 

![image](https://github.com/aarott/pentest23/assets/78908566/2e365821-c39c-4ce6-bfa5-d578904ed8cd)  

##  

Avasin labran ja päivitin sivua. Zapista löysin GET:Image(filename) requestin mitä kävin muokkaamassa Request editorilla kuten edellisessä tehtävässä.  

Muokkasin filename=../../../etc/passwd ja painoin Send. Sen jälkeen painoin päivitin portswigger sivustoa Refresh napista ja se ilmoitti labran olevan solved.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/fb15c442-3c06-4e69-97db-6abcb888d021)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/828de5f2-4e74-478e-b475-dd30f0c64424)  

## 

## e) https://portswigger.net/web-security/file-path-traversal/lab-absolute-path-bypass File path traversal, traversal sequences blocked with absolute path bypass  

Tämä tehtävä ratkesi samalla tavalla kuin edellinen, vinkeissä oli muuttaa filename= kohtaa vastaamaan /etc/passwd.  

Avasin tällä kertaa Requester tabin klikkaamlaa GET:image(filename) listasta. Muokkasin requestia ja painoin send. Sen jälkeen selain muutti labran solved.  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/5abdb35f-a46b-4446-908e-43d47386d55a)  

##

![image](https://github.com/aarott/pentest23/assets/78908566/440c737e-9e45-4b6f-9fb8-d1d810ff638b)  

##  

## f) https://portswigger.net/web-security/file-path-traversal/lab-sequences-stripped-non-recursively File path traversal, traversal sequences stripped non-recursively

![image](https://github.com/aarott/pentest23/assets/78908566/9da55db9-c8cd-4563-bc3e-87ffed456ab2)  

Tehtävässä tehjdään siis sama kuin aikaisemmissa kahdessa tehtävässä. Kävin muuttamassa GET:image(filename) requestia ja painoin send.  Lab solved.  

##

![image](https://github.com/aarott/pentest23/assets/78908566/b1fc913d-f8ae-4c1a-8efc-2364fc38e4fb)  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/a232bfb9-13c4-4121-a410-2e4e996c10c2)  

##  

## g)  Server-side template injection with information disclosure via user-supplied objects https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-with-information-disclosure-via-user-supplied-objects  

Tehtävä merkitty vaikeammaksi, teen viimeisenä kuten kehoitettu.  


## h) Basic SSRF against the local server https://portswigger.net/web-security/ssrf/lab-basic-ssrf-against-localhost  

##  

![image](https://github.com/aarott/pentest23/assets/78908566/a790be91-d1dc-439b-9f1c-45619267132e)  

##  

Menin labran sivuille ja klikkasin ensimmäistä tuotetta. Sivuston alareunassa oli Check Stock nappi.  Laitoin Zapin break päälle punaisesta napista ja klikkasin Check Stock nappia, sen jälkeen Zapista play napilla saatiin requesti näkyviin.  
Menin taas requester tabiin ja kuten näkyy sen alareunassa on "stockApi=" kohta mitä pitää muokata http://localhost/admin  ja painoin Send.  

##

![image](https://github.com/aarott/pentest23/assets/78908566/c3f89b61-0867-4d79-b7d9-67c641c1882f)

##  

En kuitenkaan pääse admin interfaceen kuten ohjeissa, jätän tämän tehtävän ja menen seuraavaan.  Pitää palata tähän myöhemmin...  

##  

## i)  Reflected XSS into HTML context with nothing encoded https://portswigger.net/web-security/cross-site-scripting/reflected/lab-html-context-nothing-encoded  















